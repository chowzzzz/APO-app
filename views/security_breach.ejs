<% include partials/header %>
<% include partials/nav %>

<%
function UNIXConverter(UNIX_timestamp){
  try {
    if (UNIX_timestamp == 0 || isNaN(UNIX_timestamp)) {
      return "-";
    }
    var a = new Date(UNIX_timestamp * 1000);
    var year = a.getFullYear();
    var month = a.getMonth() + 1;
    var date = a.getDate();
    if (month < 10) {
      month = "0" + month;
    }
    if (date < 10) {
      date = "0" + date;
    }
    var time = date + '/' + month + '/' + year;
    return time;
  } catch (error) {
    return "";
  }
}
%>

<% if (user.role == 1) { %>
<div class="container-fluid">
  <h4 class="mt-4">Security Breach -
    <%=officer_details.nric%>
  </h4>
  <hr>

  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <a class="nav-link" href="/access_control/<%=officer_details.nric%>">AC</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/general_screener/<%=officer_details.nric%>">GS</a>
    </li>
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
        aria-expanded="false">X-Ray</a>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="/xray_hbs/<%=officer_details.nric%>">X-Ray HBS</a>
        <a class="dropdown-item" href="/xray_pb/<%=officer_details.nric%>">X-Ray Pre-Board</a>
        <a class="dropdown-item" href="/xray_cargo/<%=officer_details.nric%>">X-Ray Cargo</a>
      </div>
    </li>
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle active" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
        aria-expanded="false">ST & SB</a>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="/security_test/<%=officer_details.nric%>">Security Test</a>
        <a class="dropdown-item" href="#">Security Breach</a>
      </div>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/others/<%=officer_details.nric%>">Others</a>
    </li>
  </ul>

  <table class="table table-hover table-bordered table-striped table-responsive-sm col-sm-10 mx-auto p-0 mb-4">
    <thead class="thead-light">
      <tr>
        <th>Test Name</th>
        <th>Breach Offense</th>
        <th>Location</th>
        <th>Date</th>
        <th>Time</th>
      </tr>
    </thead>
    <% if (sb_details == null) { %>
    <tr>
      <td class="mx-auto text-danger" colspan="5">Officer does not have any existing security breach records.</td>
    </tr>
    <% } %>

    <% for (var security_breach_id in sb_details) { %>
    <tr class='clickable-row' data-href='/security_breach/<%=officer_details.nric%>/<%=security_breach_id%>'>
      <td>
        <%=sb_details[security_breach_id].sb_name%>
      </td>
      <td>
        <%=sb_details[security_breach_id].sb_breachOff%>
      </td>
      <td>
        <%=sb_details[security_breach_id].sb_location%>
      </td>
      <td>
        <%=UNIXConverter(sb_details[security_breach_id].sb_date)%>
      </td>
      <td>
        <%=sb_details[security_breach_id].sb_time%>
      </td>
    </tr>
    <% } %>
  </table>

  <div class="mb-4 col-11 mx-auto">
    <a href="/security_breach/new/<%=officer_details.nric%>" class="btn btn-primary col-sm-6">Add New Record</a>

  </div>
</div>

<% } else if (user.role == 2 || user.role == 3) { %>
<div class="title">
  <h4>
    Security Breach -
    <%=officer_details.nric%>
  </h4>
</div>
<div class="container-fluid">
  <% if (user.role == 2) { %>
  <div class="col-11 mx-auto">
    <a href="/security_breach/new/<%=officer_details.nric%>" class="btn btn-primary col-sm-6"><i class="fas fa-plus-circle"></i>
      &nbsp;Add New Record</a>
  </div>
  <hr>
  <% } %>


  <% if (sb_details == null) { %>
  <p class="text-danger">Officer does not have any existing security breach records.</p>
  <% } %>

  <% for (var security_breach_id in sb_details) { %>
  <a href="/security_breach/<%=officer_details.nric%>/<%=security_breach_id%>" class="card bg-light mb-3 text-left mx-auto">
    <div class="card-header font-weight-bold">
      Test Name:
      <%=sb_details[security_breach_id].sb_name%>
    </div>
    <div class="card-body py-2 px-3">

      <div class="card-text">
        <p class="mb-0">Breach Offense:
          <%=sb_details[security_breach_id].sb_name%>
        </p>
        <p class="mb-0">Location:
          <%=sb_details[security_breach_id].sb_location%>
        </p>
        <p class="mb-0">Date:
          <%=UNIXConverter(sb_details[security_breach_id].sb_date)%>
        </p>
        <p class="mb-0">Time:
          <%=sb_details[security_breach_id].sb_time%>
        </p>

      </div>
    </div>
  </a>

  <% } %>

</div>
<% } %>

<% include partials/footer %>